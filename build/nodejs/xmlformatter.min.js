var LabEG=this.LabEG||{};if(LabEG.Lib=LabEG.Lib||{},LabEG.Lib.XMLFormatter)throw new Error("Redefine: LabEG.Lib.XMLFormatter");!function(){"use strict";var e=require("fs"),t="/tmp/streamtest.html",r="/tmp/write.html",s=e.createReadStream(t,{encoding:"utf8",autoClose:!0,highWaterMark:4096}),a=e.createWriteStream(r,{encoding:"utf8",autoClose:!0});LabEG.Lib.XMLFormatter=function(){};var o,n={charsBetweenTags:"\r\n\r\n",charsForTabs:"    "},l="",c=!1,g=0,i=0,h="",b=0,m=/^<[^!\/].*?>/,f=/^<\/.*?>/,T=/^<!--.*?-->/,w=/^<(meta|link|img|br)[^<>]*?>/,u=/^<!.*?>/,L=/^<[^<>]*?\/>/,d=/^[^<>]+/;s.on("data",function(e){for(c=!1,e=l+e.replace(/>(\r|\n|\r\n|\s)+</g,"><");!c;)if(o=e.match(L)){for(e=e.substring(o[0].length,e.length),h="",b=0;g>b;b+=1)h+=n.charsForTabs;console.log("Tag without pair: ",h+o[0]),a.write(h+o[0]+n.charsBetweenTags)}else if(o=e.match(w)){for(e=e.substring(o[0].length,e.length),h="",b=0;g>b;b+=1)h+=n.charsForTabs;console.log("Not paired html tag: ",h+o[0]),a.write(h+o[0]+n.charsBetweenTags)}else if(o=e.match(m)){for(e=e.substring(o[0].length,e.length),h="",b=0;g>b;b+=1)h+=n.charsForTabs;g+=1,console.log("Tag open: ",h+o[0]),a.write(h+o[0]+n.charsBetweenTags)}else if(o=e.match(f)){for(e=e.substring(o[0].length,e.length),g-=1,h="",b=0;g>b;b+=1)h+=n.charsForTabs;console.log("Tag close: ",h+o[0]),a.write(h+o[0]+n.charsBetweenTags)}else if(o=e.match(d)){for(e=e.substring(o[0].length,e.length),h="",b=0;g>b;b+=1)h+=n.charsForTabs;console.log("Simple text: ",h+o[0]),a.write(h+o[0]+n.charsBetweenTags)}else if(o=e.match(T)){for(e=e.substring(o[0].length,e.length),h="",b=0;g>b;b+=1)h+=n.charsForTabs;console.log("HTML comment: ",h+o[0]),a.write(h+o[0]+n.charsBetweenTags)}else if(o=e.match(u)){for(e=e.substring(o[0].length,e.length),h="",b=0;g>b;b+=1)h+=n.charsForTabs;console.log("HTML spec tag: ",h+o[0]),a.write(h+o[0]+n.charsBetweenTags)}else 0!==e.length?e.length>0?(l=e,c=!0,console.log("Parsing All block ended, ending is cached to next cycle.")):(i+=1,i>3&&(c=!0,console.log("Cycles limit."))):(c=!0,l="",console.log("Parsing All block complete."))}),s.on("end",function(){console.log("End stream."),a.end()})}();