var LabEG=this.LabEG||{};if(LabEG.Lib=LabEG.Lib||{},LabEG.Lib.XMLFormatter)throw new Error("Redefine: LabEG.Lib.XMLFormatter");!function(){"use strict";LabEG.Lib.XMLFormatter=function(){var t=this;this.options={charsBetweenTags:"\r\n\r\n",charsForTabs:"    "},this.onLog=function(t){console.log("XMLFormatter log: ",t)},this.onWarning=function(t){console.warn("XMLFormatter warning: ",t)},this.onError=function(t){console.error("XMLFormatter error: ",t)};var e="",o="",n=!1,r=0,s=[],a=0,i="",g=0,h={XMLTagOpen:/^<[^!\/].*?>/,XMLTagClose:/^<\/.*?>/,HTMLComment:/^<!--.*?-->/,HTMLNotPairedTags:/^<(meta|link|img|br)[^<>]*?>/,HTMLSpecTag:/^<!.*?>/,XMLTagWithoutPaier:/^<[^<>]*?\/>/,SimpleText:/^[^<>]+/,EmptyTextNode:/^(\r|\n|\r\n|\s)+/};this.format=function(c){for(o="",n=!1,r=0,a=0;!n;)if(s=c.match(h.EmptyTextNode)){for(c=c.substring(s[0].length,c.length),i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;t.onLog(i+"Empty text node or new line.")}else if(s=c.match(h.XMLTagWithoutPaier)){for(c=c.substring(s[0].length,c.length),i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;t.onLog(i+"Tag without pair: "+s[0]),o+=i+s[0]+t.options.charsBetweenTags}else if(s=c.match(h.HTMLNotPairedTags)){for(c=c.substring(s[0].length,c.length),i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;t.onLog(i+"Not paired html tag: "+s[0]),o+=i+s[0]+t.options.charsBetweenTags}else if(s=c.match(h.XMLTagOpen)){for(c=c.substring(s[0].length,c.length),i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;r+=1,t.onLog(i+"Tag open: "+s[0]),o+=i+s[0]+t.options.charsBetweenTags}else if(s=c.match(h.XMLTagClose)){for(c=c.substring(s[0].length,c.length),r-=1,i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;t.onLog(i+"Tag close: "+s[0]),o+=i+s[0]+t.options.charsBetweenTags}else if(s=c.match(h.SimpleText)){for(c=c.substring(s[0].length,c.length),i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;t.onLog(i+"Simple text: "+s[0]),o+=i+s[0]+t.options.charsBetweenTags}else if(s=c.match(h.HTMLComment)){for(c=c.substring(s[0].length,c.length),i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;t.onLog(i+"HTML comment: "+s[0]),o+=i+s[0]+t.options.charsBetweenTags}else if(s=c.match(h.HTMLSpecTag)){for(c=c.substring(s[0].length,c.length),i="",g=0;r>g;g+=1)i+=t.options.charsForTabs;t.onLog(i+"HTML spec tag: "+s[0]),o+=i+s[0]+t.options.charsBetweenTags}else 0!==c.length?c.length>0?(e=c,n=!0,t.onLog("Parsing All block ended, ending is cached to next cycle.")):(a+=1,a>3&&(n=!0,this.onWarning("Cycles limit."))):(n=!0,e="",t.onLog("Parsing All block complete."));return o}}}(),function(){"use strict";var t=require("fs"),e=LabEG.Lib.XMLFormatter,o="/tmp/streamtest.html",n="/tmp/write.html",r=t.createReadStream(o,{encoding:"utf8",autoClose:!0,highWaterMark:4096}),s=t.createWriteStream(n,{encoding:"utf8",autoClose:!0}),a=new e;r.on("data",function(t){console.log("Writing chunk on disk."),s.write(a.format(t))}),r.on("end",function(){console.log("End stream."),s.end()})}();