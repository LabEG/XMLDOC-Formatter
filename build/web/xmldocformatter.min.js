var LabEG=this.LabEG||{};if(LabEG.Lib=LabEG.Lib||{},LabEG.Lib.XMLDOCFormatter)throw new Error("Redefine: LabEG.Lib.XMLFormatter");!function(){"use strict";LabEG.Lib.XMLDOCFormatter=function(){var e=this;this.options={charsBetweenTags:"\r\n",charsForTabs:"    ",notPairedTags:"meta|link|img|br|input".split("|"),isMultilineAttributes:!1},this.onLog=function(){},this.onWarning=function(e){console.warn("XMLFormatter warning: ",e)},this.onError=function(e){console.error("XMLFormatter error: ",e)};var t="",n="",o=!1,r=0,a=[],i=0,s="",c=[],l=0,g={Comment:/^<!--.*?-->/,Tag:/^<[\s\S]*?>/,Text:/^[^<]+/,Empty:/^(\r|\n|\r\n|\s|\t)+/};this.format=function(h){for(n="",o=!1,i=0,h=t+h;!o;)if(a=h.match(g.Empty))h=h.substring(a[0].length,h.length),e.onLog(s+"Empty text node or new line.");else if(a=h.match(g.Comment)){for(h=h.substring(a[0].length,h.length),s="",l=0;r>l;l+=1)s+=e.options.charsForTabs;e.onLog(s+"HTML comment: "+a[0]),n+=s+a[0]+e.options.charsBetweenTags}else if(a=h.match(g.Tag)){for(h=h.substring(a[0].length,h.length),a[0]=a[0].replace(/\r|\n|\r\n/g,"").replace(/\s{2,}/g," ").replace(/^<\s/g,"<").replace(/\s>$/g,">"),a[0].match(/^<\//)&&(r-=1,c[r]!==a[0].match(/^<\/(.*?)[\s>]/)[1]?e.onWarning("Not corrected closed tag: ",c[r]," - ",a[0].match(/^<\/(.*?)[\s>]/)[1]):c[r]=null),s="",l=0;r>l;l+=1)s+=e.options.charsForTabs;a[0].match(/^<[!\/]/)||a[0].match(/\/>$/)||(c[r]=a[0].match(/^<(.*?)[\s>]/)[1],-1===e.options.notPairedTags.indexOf(c[r])&&(r+=1)),e.onLog(s+"Tag: "+a[0]),n+=s+a[0]+e.options.charsBetweenTags}else if(a=h.match(g.Text)){for(h=h.substring(a[0].length,h.length),a[0]=a[0].replace(/\r|\n|\r\n/g,"").replace(/\s{2,}/g," "),s="",l=0;r>l;l+=1)s+=e.options.charsForTabs;e.onLog(s+"Simple text: "+a[0]),n+=s+a[0]+e.options.charsBetweenTags}else 0!==h.length?h.length>0?(t=h,o=!0,e.onLog("Parsing All block ended, ending is cached to next cycle.")):(i+=1,i>3&&(o=!0,e.onWarning("Cycles limit."))):(o=!0,t="",e.onLog("Parsing All block complete."));return n},this.clear=function(){t="",r=0,c.length=0}},"undefined"!=typeof module&&null!==module&&module.exports?module.exports=LabEG.Lib.XMLDOCFormatter:"function"==typeof define&&define.amd&&define(function(){return LabEG.Lib.XMLDOCFormatter})}();