var LabEG=this.LabEG||{};if(LabEG.Lib=LabEG.Lib||{},LabEG.Lib.XMLDOCFormatter)throw new Error("Redefine: LabEG.Lib.XMLFormatter");!function(){"use strict";LabEG.Lib.XMLDOCFormatter=function(){var e=this;this.options={charsBetweenTags:"\r\n",charsForTabs:"    ",notPairedTags:"meta|link|img|br|input|param|hr|wbr".split("|"),isMultilineAttributes:!1},this.logLevels={none:0,debug:1,verbose:2,errors:4,warnings:8},this.onLog=function(){},this.onWarning=function(e){console.log("XMLFormatter warning: ",e)},this.onError=function(e){console.log("XMLFormatter error: ",e)},this.onStyle=function(e){return e},this.onScript=function(e){return e};var t="",n="",r=!1,o=0,s=[],i=0,a="",g=[],l=1,c=0;this.regexps={Comment:/^<!--.*?-->/,Tag:/^<[\s\S]*?>/,Text:/^[^<]+/,Empty:/^(\s)+/},this.format=function(h){for(n="",r=!1,i=0,h=t+h;!r;){if(void 0!==g[o-1]&&-1!==["style","script"].indexOf(g[o-1].tag)&&(s=h.match(/^([\s\S]*?)<\/[\s]*?(script|style)>/),s&&s[1]&&""!==s[1])){for(h=h.substring(s[1].length,h.length),"script"===g[o-1].tag&&(s[1]=e.onScript(s[1])),"style"===g[o-1].tag&&(s[1]=e.onStyle(s[1])),a="",c=0;o>c;c+=1)a+=e.options.charsForTabs;s[1]=e.options.charsBetweenTags+a+s[1].replace(/\r\n|\r|\n/g,"\r\n"+a)+e.options.charsBetweenTags,n+=s[1]+e.options.charsBetweenTags,l+=s[1].split(/\r\n|\r|\n/).length,e.onLog(a+"Style or Script code: \r\n"+s[1])}if(s=h.match(e.regexps.Empty),s&&(h=h.substring(s[0].length,h.length),e.onLog(a+"Empty text node or new line.")),s=h.match(e.regexps.Comment)){for(h=h.substring(s[0].length,h.length),a="",c=0;o>c;c+=1)a+=e.options.charsForTabs;l+=1,e.onLog(a+"HTML comment: "+s[0]),n+=a+s[0]+e.options.charsBetweenTags}else if(s=h.match(e.regexps.Tag)){for(h=h.substring(s[0].length,h.length),s[0]=s[0].replace(/\r|\n|\r\n/g,"").replace(/\s{2,}/g," ").replace(/^<\s+/g,"<").replace(/\s+>$/g,">"),s[0].match(/^<\//)&&(o-=1,g[o].tag!==s[0].match(/^<\/(.*?)[\s>]/)[1]?e.onWarning("Not corrected closed tag: "+g[o].lineNumber+". "+g[o].tag+" - "+l+". "+s[0].match(/^<\/(.*?)[\s>]/)[1]):g[o]=null),a="",c=0;o>c;c+=1)a+=e.options.charsForTabs;s[0].match(/^<[!\/]/)||s[0].match(/\/>$/)||(g[o]={lineNumber:l,tag:s[0].match(/^<(.*?)[\s>]/)[1]},-1===e.options.notPairedTags.indexOf(g[o].tag)&&(o+=1)),l+=1,e.onLog(a+"Tag: "+s[0]),n+=a+s[0]+e.options.charsBetweenTags}else if(s=h.match(e.regexps.Text),s&&void 0!==g[o-1]&&-1===["style","script"].indexOf(g[o-1].tag)){for(h=h.substring(s[0].length,h.length),s[0]=s[0].replace(/\r|\n|\r\n/g,"").replace(/\s{2,}/g," "),a="",c=0;o>c;c+=1)a+=e.options.charsForTabs;l+=1,e.onLog(a+"Simple text: "+s[0]),n+=a+s[0]+e.options.charsBetweenTags}else 0!==h.length?h.length>0?(t=h,r=!0,e.onLog("Parsing All block ended, ending is cached to next cycle.")):(i+=1,i>3&&(r=!0,e.onWarning("Cycles limit."))):(r=!0,t="",e.onLog("Parsing All block complete."))}return n},this.clear=function(){t="",o=0,g.length=0}},"undefined"!=typeof module&&null!==module&&module.exports?module.exports=LabEG.Lib.XMLDOCFormatter:"function"==typeof define&&define.amd&&define(function(){return LabEG.Lib.XMLDOCFormatter})}();