!function(){"use strict";var e,t=require("fs"),s="/tmp/streamtest.html",n="/tmp/write.html",r=t.createReadStream(s,{encoding:"utf8",autoClose:!0,highWaterMark:4096}),o=t.createWriteStream(n,{encoding:"utf8",autoClose:!0}),a={charsBetweenTags:"\r\n\r\n",charsForTabs:"    "},l="",g=!1,c=0,h=0,i="",m=0,f=/^<[^!\/].*?>/,T=/^<\/.*?>/,b=/^<!--.*?-->/,u=/^<(meta|link|img|br)[^<>]*?>/,w=/^<!.*?>/,d=/^<[^<>]*?\/>/,p=/^[^<>]+/;r.on("data",function(t){for(g=!1,t=l+t.replace(/>(\r|\n|\r\n|\s)+</g,"><");!g;)if(e=t.match(d)){for(t=t.substring(e[0].length,t.length),i="",m=0;c>m;m+=1)i+=a.charsForTabs;console.log("Tag without pair: ",i+e[0]),o.write(i+e[0]+a.charsBetweenTags)}else if(e=t.match(u)){for(t=t.substring(e[0].length,t.length),i="",m=0;c>m;m+=1)i+=a.charsForTabs;console.log("Not paired html tag: ",i+e[0]),o.write(i+e[0]+a.charsBetweenTags)}else if(e=t.match(f)){for(t=t.substring(e[0].length,t.length),i="",m=0;c>m;m+=1)i+=a.charsForTabs;c+=1,console.log("Tag open: ",i+e[0]),o.write(i+e[0]+a.charsBetweenTags)}else if(e=t.match(T)){for(t=t.substring(e[0].length,t.length),c-=1,i="",m=0;c>m;m+=1)i+=a.charsForTabs;console.log("Tag close: ",i+e[0]),o.write(i+e[0]+a.charsBetweenTags)}else if(e=t.match(p)){for(t=t.substring(e[0].length,t.length),i="",m=0;c>m;m+=1)i+=a.charsForTabs;console.log("Simple text: ",i+e[0]),o.write(i+e[0]+a.charsBetweenTags)}else if(e=t.match(b)){for(t=t.substring(e[0].length,t.length),i="",m=0;c>m;m+=1)i+=a.charsForTabs;console.log("HTML comment: ",i+e[0]),o.write(i+e[0]+a.charsBetweenTags)}else if(e=t.match(w)){for(t=t.substring(e[0].length,t.length),i="",m=0;c>m;m+=1)i+=a.charsForTabs;console.log("HTML spec tag: ",i+e[0]),o.write(i+e[0]+a.charsBetweenTags)}else 0!==t.length?t.length>0?(l=t,g=!0,console.log("Parsing All block ended, ending is cached to next cycle.")):(h+=1,h>3&&(g=!0,console.log("Cycles limit."))):(g=!0,l="",console.log("Parsing All block complete."))}),r.on("end",function(){console.log("End stream."),o.end()})}();